<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copy Buster</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="content-wrapper">
        <div class="container">
            <h1>Copy Buster</h1>
            <textarea placeholder="enter your text here..." lang="da"></textarea>
            <button id ="runbutton">check plagiarism</button>
            <div class="animation"></div>
            
        </div>
        <button id="detailbutton">Details</button>
        <div id="detailbox" class="detailtextarea"></div>
        <button id="detailclosebutton">X&times;</button>
            
        
        

        <div class="right-side">
            
            <table class="info-table">
                <tr>
                    <td id="jaccardSimilarity">Jaccard Similarity: </td>
                    <td id="jaccardIndex">Most Similar Article Index: </td>
                </tr>
                <tr>
                    <td id="cosineSimilarity">Cosine Similarity: </td>
                    <td id="cosineIndex">Most Similar Article Index: </td>
                </tr>
            </table>            
            <div class="box large" id="articleContent"></div>
        </div>
    </div>

    

    

    <script>

        const textarea = document.querySelector('textarea');
        const runbutton = document.querySelector('runbutton');
        const animationDiv = document.querySelector('.animation');
        const rightSide = document.querySelector('.right-side'); // Add this line
        const detailbutton = document.querySelector('detailbutton');
    
        textarea.addEventListener('input', function() {
            if (this.value) {
                this.style.fontStyle = 'normal';
                this.style.color = 'black';
            } else {
                this.style.fontStyle = 'italic';
                this.style.color = '#9e9c9a';
            }
        });
    
        runbutton.addEventListener('click', function() {
            // clear the output area
            console.log("hello");
            document.getElementById('articleContent').innerHTML = '';

            if (textarea.value.trim().length < 1){
                alert("The input can not be empty.")
                return;
            }

            if (textarea.value.trim().length > 5000){
                alert("Sorry, the input is too long.")
                return;
            }
            detailbutton.addEventListener('click', function() {
                // open detail sheet
                console.log("hello");
                document.getElementById("detailbox").style.display = "block";
                document.getElementById("detailclosebutton").style.display = "block";

            })
            document.getElementById("detailclosebutton").addEventListener("click", function() {
            document.getElementById("detailbox").style.display = "none";
            document.getElementById("detailclosebutton").style.display = "none";

            })


            animationDiv.style.display = 'block';
            animationDiv.classList.add('active');
    
            rightSide.style.display = 'block';
    
            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    text: textarea.value
                }),
            })
            .then(response => response.json())
            .then(data => {
                //results:
                document.getElementById('jaccardSimilarity').innerHTML = `Final Jaccard Similarity: ${data.jaccardSimilarity[0]}`;
                document.getElementById('jaccardIndex').innerHTML = `Most Similar Article Index: ${data.jaccardSimilarity[1]+1}`;
                document.getElementById('cosineSimilarity').innerHTML = `Final Cosine Similarity: ${data.cosineSimilarity[0]}%`;
                document.getElementById('cosineIndex').innerHTML = `Most Similar Article Index: ${data.cosineSimilarity[1]+1}`;
            
    

                animationDiv.style.display = 'none';
                animationDiv.classList.remove('active');
            
                // farve til sætninger ud fra plagiatprocent, og hoverover så man kan se % og highlight af den modsat matchende sætning
                // Add titles to sentences + add color from percentage
                const output = document.getElementById('articleContent')
                output.innerHTML += `<p>Hover over a sentence to see matching sentence in input and similarity percentage </p>`
                for (let i = 0; i < data.Articles.length; i++) {
                    output.innerHTML += `<h3>Article name: ${data.Articles[i].title}</h3>`
                       for(let j = 0; j < data.Articles[i].sentences.length; j++) {
                       if (data.Articles[i].sentences[j].percentage > 50.0){
                            if (data.Articles[i].sentences[j].percentage > 90) {
                                output.innerHTML += `<p class = "sentence90" title="${data.Articles[i].sentences[j].percentage}%">${data.Articles[i].sentences[j].content}</p>`
                            }
                            else if (data.Articles[i].sentences[j].percentage > 80){
                                output.innerHTML += `<p class = "sentence80" title="${data.Articles[i].sentences[j].percentage}%">${data.Articles[i].sentences[j].content}</p>`
                            }
                            else if (data.Articles[i].sentences[j].percentage > 70){
                                output.innerHTML += `<p class = "sentence70" title="${data.Articles[i].sentences[j].percentage}%">${data.Articles[i].sentences[j].content}</p>`
                            }
                            else if (data.Articles[i].sentences[j].percentage > 60){
                                output.innerHTML += `<p class = "sentence60" title="${data.Articles[i].sentences[j].percentage}%">${data.Articles[i].sentences[j].content}</p>`
                            }
                            else if (data.Articles[i].sentences[j].percentage > 50){
                                output.innerHTML += `<p class = "sentence50" title="${data.Articles[i].sentences[j].percentage}%">${data.Articles[i].sentences[j].content}</p>`
                            }
                        }
                    }
                }
                

            })
            .catch((error) => {
                console.error('Error:', error);
                resultDisplay.textContent = 'Error calculating similarity. Please try again.';
                animationDiv.style.display = 'none';
                animationDiv.classList.remove('active');
            });
        });

        
                
    </script>
    
</body>
</html>
